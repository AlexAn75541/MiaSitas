version: "3.8"

services:
    lavalink:
        image: ghcr.io/lavalink-devs/lavalink:latest
        container_name: lavalink
        restart: unless-stopped
        environment:
            - _JAVA_OPTIONS=-Xmx1G
            - SERVER_PORT=2333
            - LAVALINK_SERVER_PASSWORD=youshallnotpass
        healthcheck:
            test: 'curl -H "Authorization: youshallnotpass" -s http://localhost:2333/version'
            interval: 10s
            timeout: 10s
            retries: 5
            start_period: 10s
        volumes:
            - ./application.yml:/opt/Lavalink/application.yml
        networks:
            - local
        expose:
            - "2333"

    # mongo:
    #     image: mongo:latest
    #     container_name: mongo
    #     restart: unless-stopped
    #     volumes:
    #         - ./data/mongo/db:/data/db
    #         - ./data/mongo/conf:/data/configdb
    #     environment:
    #         - MONGO_INITDB_ROOT_USERNAME=admin
    #         - MONGO_INITDB_ROOT_PASSWORD=admin
    #     expose:
    #         - "27017"
    #     networks:
    #         - local
    #     command: ["mongod", "--oplogSize=1024", "--wiredTigerCacheSizeGB=1", "--auth", "--noscripting"]

    vocard:
        image: vocard
        container_name: vocard
        build:
            dockerfile: ./Dockerfile
        volumes:
            - ./settings.json:/app/settings.json
            - ./logs/supervisor/:/var/log
        environment:
            - TOKEN=YOUR_BOT_TOKEN
            - CLIENT_ID=YOUR_BOT_CLIENT_ID
            - CLIENT_SECRET_ID=YOUR_BOT_CLIENT_SECRET_ID
            - SECRET_KEY=DASHBOARD_SECRET_KEY
            - BUG_REPORT_CHANNEL_ID=YOUR_DISCORD_CHANNEL_ID
            - SPOTIFY_CLIENT_ID=YOUR_SPOTIFY_CLIENT_ID
            - SPOTIFY_CLIENT_SECRET=YOUR_SPOTIFY_CLIENT_SECRET
            - GENIUS_TOKEN=YOUR_GENIUS_TOKEN
            - MONGODB_URL=YOUR_MONGODB_URL
            - MONGODB_NAME=YOUR_MONGODB_DB_NAME
            - DASHBOARD_HOST=0.0.0.0
            - DASHBOARD_PORT=5555

        depends_on:
            lavalink:
                condition: service_healthy
            # mongo:
            #     condition: service_started
        ports:
            - "5555:5555"
        networks:
            - local

networks:
    local:
        name: local
